{% if item == "csv" %}
Access Control List,Access Control Entry,Permission,Logging,Source Network,Destination Network,L3 Protocol,L4 Protocol,Operator,Port
{%     for list in pyats_all_access_lists %}
{%        if pyats_all_access_lists[list].aces is defined %}
{%            for ace in pyats_all_access_lists[list].aces %}
{%                if pyats_all_access_lists[list].aces[ace].matches.l3.ipv4.source_network is defined %}
{%                    for source_network in pyats_all_access_lists[list].aces[ace].matches.l3.ipv4.source_network %}
{{ list }},{{ ace }},{{ pyats_all_access_lists[list].aces[ace].actions.forwarding }},{% if pyats_all_access_lists[list].aces[ace].actions.logging is defined %}{{ pyats_all_access_lists[list].aces[ace].actions.logging }}{% else %}No Logging{% endif %},{{ pyats_all_access_lists[list].aces[ace].matches.l3.ipv4.source_network[source_network] | regex_replace("{'source_network': ","") | regex_replace("}","") | regex_replace("'","") }},{% if pyats_all_access_lists[list].aces[ace].matches.l3.ipv4.destination_network is defined %}{{ pyats_all_access_lists[list].aces[ace].matches.l3.ipv4.destination_network | regex_replace(" {'destination_network': .*","") | regex_replace("{","") | regex_replace("'","") | regex_replace(":","") }}{% else %}N/A{% endif %},{% if pyats_all_access_lists[list].aces[ace].matches.l3.ipv4.protocol is defined %}{{ pyats_all_access_lists[list].aces[ace].matches.l3.ipv4.protocol }}{% else %}N/A{% endif %},{% if pyats_all_access_lists[list].aces[ace].matches.l4 is defined %}{% if pyats_all_access_lists[list].aces[ace].matches.l4.tcp is defined %}TCP,{% if pyats_all_access_lists[list].aces[ace].matches.l4.tcp.destination_port is defined %}{{ pyats_all_access_lists[list].aces[ace].matches.l4.tcp.destination_port.operator.operator }},{{ pyats_all_access_lists[list].aces[ace].matches.l4.tcp.destination_port.operator.port }}{% else %}N/A,N/A{% endif %}{% else %}UDP,{%if pyats_all_access_lists[list].aces[ace].matches.l4.udp.destination_port is defined %}{{ pyats_all_access_lists[list].aces[ace].matches.l4.udp.destination_port.operator.operator }},{{ pyats_all_access_lists[list].aces[ace].matches.l4.udp.destination_port.operator.port }}{% else %}N/A,N/A{% endif %}{% endif %}{% else %}N/A,N/A,N/A{% endif %}

{%                    endfor %}
{%                else %}
{{ list }},{{ ace }},{{ pyats_all_access_lists[list].aces[ace].actions.forwarding }},{% if pyats_all_access_lists[list].aces[ace].actions.logging is defined %}{{ pyats_all_access_lists[list].aces[ace].actions.logging }}{% else %}No Logging{% endif %},N/A,{% if pyats_all_access_lists[list].aces[ace].matches.l3.ipv4.destination_network is defined %}{{ pyats_all_access_lists[list].aces[ace].matches.l3.ipv4.destination_network  | regex_replace(" {'destination_network': .*","") | regex_replace("{","") | regex_replace("'","") | regex_replace(":","") }}{% else %}N/A{% endif %},{% if pyats_all_access_lists[list].aces[ace].matches.l3.ipv4.protocol is defined %}{{ pyats_all_access_lists[list].aces[ace].matches.l3.ipv4.protocol }}{% else %}N/A{% endif %},{% if pyats_all_access_lists[list].aces[ace].matches.l4 is defined %}{% if pyats_all_access_lists[list].aces[ace].matches.l4.tcp is defined %}TCP,{% if pyats_all_access_lists[list].aces[ace].matches.l4.tcp.destination_port is defined %}{{ pyats_all_access_lists[list].aces[ace].matches.l4.tcp.destination_port.operator.operator }},{{ pyats_all_access_lists[list].aces[ace].matches.l4.tcp.destination_port.operator.port }}{% else %}N/A,N/A{% endif %}{% else %}UDP,{%if pyats_all_access_lists[list].aces[ace].matches.l4.udp.destination_port is defined %}{{ pyats_all_access_lists[list].aces[ace].matches.l4.udp.destination_port.operator.operator }},{{ pyats_all_access_lists[list].aces[ace].matches.l4.udp.destination_port.operator.port }}{% else %}N/A,N/A{% endif %}{% endif %}{% else %}N/A,N/A,N/A{% endif %}

{%                endif %}
{%            endfor %}
{%        else %}
{{ list }},No ACEs,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A
{%        endif %}
{%     endfor %}
{% else %}
# Show IP Access-Lists Facts for {{ inventory_hostname }}
| Access Control List | Access Control Entry | Permission | Logging | Source Network | Destination Network | L3 Protocol | L4 Protocol | Operator | Port |
| ------------------- | -------------------- | ---------- | ------- | -------------- | ------------------- | ----------- | ----------- | -------- | ---- |
{%     for list in pyats_all_access_lists %}
{%        if pyats_all_access_lists[list].aces is defined %}
{%            for ace in pyats_all_access_lists[list].aces %}
{%                if pyats_all_access_lists[list].aces[ace].matches.l3.ipv4.source_network is defined %}
{%                    for source_network in pyats_all_access_lists[list].aces[ace].matches.l3.ipv4.source_network %}
| {{ list }} | {{ ace }} | {{ pyats_all_access_lists[list].aces[ace].actions.forwarding }} | {% if pyats_all_access_lists[list].aces[ace].actions.logging is defined %}{{ pyats_all_access_lists[list].aces[ace].actions.logging }}{% else %}No Logging{% endif %} | {{ pyats_all_access_lists[list].aces[ace].matches.l3.ipv4.source_network[source_network] | regex_replace("{'source_network': ","") | regex_replace("}","") | regex_replace("'","") }} | {% if pyats_all_access_lists[list].aces[ace].matches.l3.ipv4.destination_network is defined %}{{ pyats_all_access_lists[list].aces[ace].matches.l3.ipv4.destination_network | regex_replace(" {'destination_network': .*","") | regex_replace("{","") | regex_replace("'","") | regex_replace(":","") }}{% else %}N/A{% endif %} | {% if pyats_all_access_lists[list].aces[ace].matches.l3.ipv4.protocol is defined %}{{ pyats_all_access_lists[list].aces[ace].matches.l3.ipv4.protocol }}{% else %}N/A{% endif %} | {% if pyats_all_access_lists[list].aces[ace].matches.l4 is defined %}{% if pyats_all_access_lists[list].aces[ace].matches.l4.tcp is defined %}TCP | {% if pyats_all_access_lists[list].aces[ace].matches.l4.tcp.destination_port is defined %}{{ pyats_all_access_lists[list].aces[ace].matches.l4.tcp.destination_port.operator.operator }} | {{ pyats_all_access_lists[list].aces[ace].matches.l4.tcp.destination_port.operator.port }}{% else %}N/A | N/A{% endif %}{% else %}UDP | {%if pyats_all_access_lists[list].aces[ace].matches.l4.udp.destination_port is defined %}{{ pyats_all_access_lists[list].aces[ace].matches.l4.udp.destination_port.operator.operator }} | {{ pyats_all_access_lists[list].aces[ace].matches.l4.udp.destination_port.operator.port }}{% else %}N/A | N/A{% endif %}{% endif %}{% else %}N/A | N/A | N/A{% endif %} |
{%                    endfor %}
{%                else %}
| {{ list }} | {{ ace }} | {{ pyats_all_access_lists[list].aces[ace].actions.forwarding }} | {% if pyats_all_access_lists[list].aces[ace].actions.logging is defined %}{{ pyats_all_access_lists[list].aces[ace].actions.logging }}{% else %}No Logging{% endif %} | N/A | {% if pyats_all_access_lists[list].aces[ace].matches.l3.ipv4.destination_network is defined %}{{ pyats_all_access_lists[list].aces[ace].matches.l3.ipv4.destination_network  | regex_replace(" {'destination_network': .*","") | regex_replace("{","") | regex_replace("'","") | regex_replace(":","") }}{% else %}N/A{% endif %} | {% if pyats_all_access_lists[list].aces[ace].matches.l3.ipv4.protocol is defined %}{{ pyats_all_access_lists[list].aces[ace].matches.l3.ipv4.protocol }}{% else %}N/A{% endif %} | {% if pyats_all_access_lists[list].aces[ace].matches.l4 is defined %}{% if pyats_all_access_lists[list].aces[ace].matches.l4.tcp is defined %}TCP | {% if pyats_all_access_lists[list].aces[ace].matches.l4.tcp.destination_port is defined %}{{ pyats_all_access_lists[list].aces[ace].matches.l4.tcp.destination_port.operator.operator }} | {{ pyats_all_access_lists[list].aces[ace].matches.l4.tcp.destination_port.operator.port }}{% else %}N/A | N/A{% endif %}{% else %}UDP | {%if pyats_all_access_lists[list].aces[ace].matches.l4.udp.destination_port is defined %}{{ pyats_all_access_lists[list].aces[ace].matches.l4.udp.destination_port.operator.operator }} | {{ pyats_all_access_lists[list].aces[ace].matches.l4.udp.destination_port.operator.port }}{% else %}N/A | N/A{% endif %}{% endif %}{% else %}N/A | N/A | N/A{% endif %} |
{%                endif %}
{%            endfor %}
{%        else %}
| {{ list }} | No ACEs | N/A | N/A | N/A | N/A | N/A | N/A | N/A | N/A |
{%        endif %}
{%     endfor %}
{% endif %}